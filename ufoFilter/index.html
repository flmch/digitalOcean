<!DOCTYPE html>
<html>
	<head>
		<title>UFO Sightings Filter</title>
		<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/skeleton/2.0.4/skeleton.css">
		<style>
			#resultList{
				width: 700px;
			}

			.UFODiv {
				border: 1px solid black;
				border-radius: 5px;
				margin: 10px;
				padding: 10px;
			}

			#listMSG{
				color: red;
			}
		</style>
	</head>
	<body>
		<h1>UFO sightings</h1>
		<h6>Search UFO Sightings by:</h6>
		<span>location: </span><input type="text" id="locationInput" placeholder="Palmdale, CA"></input>
		<span>date: </span><input type="text" id="dateInput" placeholder="mm/dd/yyyy"></input>
		<span>shape: </span><input type="text" id="shapeInput" placeholder="sphere"></input>
		<span>id: </span><input type="text" id="idInput" placeholder="1"></input>
		<br><button id="searchUFO">Search</button>
		<div id="listMSG"></div>
		<div id="resultList">
		</div>

		<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.0.0-alpha1/jquery.js">
		</script>
		<script>
			
			$(function(){
				console.log("linked");

				//append each property filter to GET url 
				function appendURL(targetURL,type,data){
					if(targetURL !== "/?"){
						targetURL += "&";
					}
					targetURL += type+"="+data;		
					return targetURL;			
				}

				//create url to get UFO results
				function getURL(){
					var targetURL = "/?";
					var location = $("#locationInput").val();
					var date = $("#dateInput").val();
					var shape = $("#shapeInput").val();
					var id = $("#idInput").val();

					if(location){
						location = location.split(",");
						location = (location[0]+", "+location[1].trim()).toLowerCase();
						targetURL = appendURL(targetURL,"l",location);
					}

					if(date){
						date = date.split("/");
						date = (+date[0])+"/"+(+date[1])+"/"+(+date[2]);
						targetURL = appendURL(targetURL,"o",date);
					}

					if(shape){
						targetURL = appendURL(targetURL,"s",shape.toLowerCase())
					}

					if(id){
						targetURL = appendURL(targetURL,"i",id);
					}

					return encodeURI(targetURL);
				}

				//clear input field
				function clearInput(){
					$("#locationInput").val("");
					$("#dateInput").val("");
					$("#shapeInput").val("");
					$("#idInput").val("");					
				}

				//add event listener to the click button
				//ajax will fetch data from server after clicked
				$("#searchUFO").on("click",function(event){
					$("#listMSG").text("");		//clean demo area
					$("#resultList").empty();
					$.ajax({
						type: "GET",
						url: getURL(),
						success: function(data){
							$("#listMSG").text(data.length+" UFOs match");
							//data is UFO object,
							//content will store all the UFO data in html format
							var content = "";
							data.forEach(function(ele){
								var oneUFO = "";
								for(var key in ele){
									oneUFO += "<strong>"+key+"</strong>"+": "+ele[key]+"<br>";									
								};
								content += "<div class=\"UFODiv\">"+oneUFO+"</div>"
							});
							$("#resultList").append(content);	
						}
					});	
					clearInput();			
				});
			});

		</script>
	</body>
</html>